<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .post-text {
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .badge-reactions {
            background: #ffeaa7;
            color: #d63031;
        }

        .badge-comments {
            background: #74b9ff;
            color: #0984e3;
        }

        .badge-shares {
            background: #a29bfe;
            color: #6c5ce7;
        }

        .api-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 0.9em;
        }

        .status-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #00b894;
        }

        .status-offline {
            background: #d63031;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Facebook Analytics Dashboard</h1>
            <p class="subtitle">Real-time data visualization and insights</p>
        </header>

        <div class="stats-grid" id="stats">
            <div class="loading">Loading statistics...</div>
        </div>

        <div class="content-section">
            <h2>ðŸ“ˆ Top Posts by Engagement</h2>
            <div id="posts">
                <div class="loading">Loading posts...</div>
            </div>
        </div>

        <div class="content-section">
            <h2>ðŸ’¬ Recent Comments</h2>
            <div id="comments">
                <div class="loading">Loading comments...</div>
            </div>
        </div>

        <div class="content-section">
            <h2>ðŸ‘¥ Top Authors</h2>
            <div id="authors">
                <div class="loading">Loading authors...</div>
            </div>
        </div>
    </div>

    <div class="api-status">
        <span class="status-dot status-offline" id="statusDot"></span>
        <span id="statusText">Connecting to API...</span>
    </div>

    <script>
        const API_URL = 'http://localhost:3002';

        // Check API health
        async function checkAPIHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();

                document.getElementById('statusDot').className = 'status-dot status-online';
                document.getElementById('statusText').textContent = 'API Connected';
                return true;
            } catch (error) {
                document.getElementById('statusDot').className = 'status-dot status-offline';
                document.getElementById('statusText').textContent = 'API Offline';
                return false;
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();

                const statsHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${data.total_posts?.toLocaleString() || 0}</div>
                        <div class="stat-label">Total Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.total_comments?.toLocaleString() || 0}</div>
                        <div class="stat-label">Total Comments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.total_reactions?.toLocaleString() || 0}</div>
                        <div class="stat-label">Total Reactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.total_shares?.toLocaleString() || 0}</div>
                        <div class="stat-label">Total Shares</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.unique_authors?.toLocaleString() || 0}</div>
                        <div class="stat-label">Unique Authors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.posts_with_images?.toLocaleString() || 0}</div>
                        <div class="stat-label">Posts with Images</div>
                    </div>
                `;

                document.getElementById('stats').innerHTML = statsHTML;
            } catch (error) {
                document.getElementById('stats').innerHTML = '<div class="error">Failed to load statistics</div>';
            }
        }

        // Load top posts
        async function loadPosts() {
            try {
                const response = await fetch(`${API_URL}/api/posts/top/engagement?limit=10`);
                const data = await response.json();

                if (data.length === 0) {
                    document.getElementById('posts').innerHTML = '<p>No posts found</p>';
                    return;
                }

                const postsHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Author</th>
                                <th>Text</th>
                                <th>Reactions</th>
                                <th>Comments</th>
                                <th>Shares</th>
                                <th>Engagement</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map(post => `
                                <tr>
                                    <td><strong>${post.author || 'Unknown'}</strong></td>
                                    <td class="post-text">${post.text_preview || 'No text'}</td>
                                    <td><span class="badge badge-reactions">${post.reactions?.toLocaleString() || 0}</span></td>
                                    <td><span class="badge badge-comments">${post.comments?.toLocaleString() || 0}</span></td>
                                    <td><span class="badge badge-shares">${post.shares?.toLocaleString() || 0}</span></td>
                                    <td><strong>${post.engagement_score?.toLocaleString() || 0}</strong></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('posts').innerHTML = postsHTML;
            } catch (error) {
                document.getElementById('posts').innerHTML = '<div class="error">Failed to load posts</div>';
            }
        }

        // Load recent comments
        async function loadComments() {
            try {
                const response = await fetch(`${API_URL}/api/comments?limit=20`);
                const data = await response.json();

                if (!data.data || data.data.length === 0) {
                    document.getElementById('comments').innerHTML = '<p>No comments found</p>';
                    return;
                }

                const commentsHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Author</th>
                                <th>Comment</th>
                                <th>Reactions</th>
                                <th>Post Author</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.data.map(comment => `
                                <tr>
                                    <td><strong>${comment.comment_author || 'Unknown'}</strong></td>
                                    <td class="post-text">${comment.comment_text || 'No text'}</td>
                                    <td><span class="badge badge-reactions">${comment.comment_reactions || 0}</span></td>
                                    <td>${comment.post_author || 'Unknown'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('comments').innerHTML = commentsHTML;
            } catch (error) {
                document.getElementById('comments').innerHTML = '<div class="error">Failed to load comments</div>';
            }
        }

        // Load top authors
        async function loadAuthors() {
            try {
                const response = await fetch(`${API_URL}/api/authors/top?limit=10`);
                const data = await response.json();

                if (data.length === 0) {
                    document.getElementById('authors').innerHTML = '<p>No authors found</p>';
                    return;
                }

                const authorsHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Author</th>
                                <th>Total Posts</th>
                                <th>Total Reactions</th>
                                <th>Total Comments</th>
                                <th>Total Shares</th>
                                <th>Avg Reactions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map(author => `
                                <tr>
                                    <td><strong>${author.author || 'Unknown'}</strong></td>
                                    <td>${author.total_posts?.toLocaleString() || 0}</td>
                                    <td><span class="badge badge-reactions">${author.total_reactions?.toLocaleString() || 0}</span></td>
                                    <td><span class="badge badge-comments">${author.total_comments?.toLocaleString() || 0}</span></td>
                                    <td><span class="badge badge-shares">${author.total_shares?.toLocaleString() || 0}</span></td>
                                    <td>${author.avg_reactions?.toLocaleString() || 0}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('authors').innerHTML = authorsHTML;
            } catch (error) {
                document.getElementById('authors').innerHTML = '<div class="error">Failed to load authors</div>';
            }
        }

        // Initialize dashboard
        async function init() {
            await checkAPIHealth();
            await loadStats();
            await loadPosts();
            await loadComments();
            await loadAuthors();

            // Refresh every 30 seconds
            setInterval(async () => {
                await checkAPIHealth();
                await loadStats();
            }, 30000);
        }

        // Start when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
